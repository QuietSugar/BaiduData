<html>
<head>
    <meta charset="utf-8">
    <title>519上车人流分布图</title>
    <style type="text/css">
        html, body, #main {
            font-family: "Courier New, monospace,微软雅黑", sans-serif;
            margin: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
<div id="main"></div>
<!--引入百度地图的jssdk，这里需要使用你在百度地图开发者平台申请的 ak-->
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=ZUONbpqGBsYGXNIYHicvbAbM"></script>
<!-- 引入 ECharts -->
<script src="../../asset/echarts/echarts.min.js"></script>
<!-- 引入百度地图扩展 -->
<script src="../../asset/echarts/extension/bmap.min.js"></script>
<script src="../../asset/jQuery/jquery-3.0.0.js"></script>
<!-- <script src="http://api.map.baidu.com/api?v=1.3" type="text/javascript"></script> -->
<script src="../Echarts2/testData/cord.js" type="text/javascript"></script>        <!--所有公交站点的经纬度-->
<script src="../Echarts2/testData/datas.js" type="text/javascript"></script>        <!--公交站点人流量数据，15分钟间隔，刷新新一次数据，此数据与上一个需关联使用-->
<script src="../Echarts2/testData/LineLL.js" type="text/javascript"></script>        <!--连点成线，所有点的经纬度-->
<script>
    // 基于准备好的dom，初始化echarts实例
    var myChart = echarts.init(document.getElementById('main'));

    var data = [];
    for (var bb = 0; bb < datas[0].length; bb++) {
        data.push(datas[0][bb]);
    }
    var top = [];
//    for (var aa = 0; aa < data.length; aa++) {
//        if (data[aa].value > 90) {
//            top.push(data[aa]);
//        }
//    }

    console.log(data);
    console.log(top);

    myChart.setOption(option = {
        title: {
            text: '519上车人流分布图',
            sublink: 'http://www.baidu.com',
            x: 'center'
        },
        tooltip: {
            trigger: 'item'
        },
        legend: {
            orient: 'vertical',
            x: 'left',
            data: ['in']
        },
        dataRange: {
            show: false,
            min: 0,
            max: 100,
            calculable: true,
            color: ['red']
        },
        toolbox: {
            show: true,
            orient: 'vertical',
            x: 'right',
            y: 'center',
            feature: {
                mark: {show: true},
                dataView: {show: true, readOnly: false},
                restore: {show: true},
                saveAsImage: {show: true}
            }
        },
        series: [
            {
                name: '进站人数',
                type: 'map',
                mapType: 'none',
                hoverable: false,
                data: [],
                markPoint: {
                    symbolSize: 5,       // 标注大小，半宽（半径）参数，当图形为方向或菱形则总宽度为symbolSize * 2
                    itemStyle: {
                        normal: {
                            color: function (v) {
                                if (v.data.value == 0) {
                                    return "rgba(255,255,255 ,0)";//白色透明
                                } else if (v.data.value < 20) {
                                    return "#00bc12";//绿色

                                } else if (v.data.value < 40) {
                                    return "#fff143";//黄色
                                } else if (v.data.value > 50) {
                                    return '#f20c00';
                                }
                            },
                            borderWidth: 12,            // 标注边线线宽，单位px，默认为1
                            label: {
                                show: true,
                                formatter: function (params) {
                                    if (params.value == 0) {
                                        return "";
                                    } else {
                                        return params.value;
                                    }

                                }
                            }
                        },
                        emphasis: {
                            borderColor: '#0c8918',
                            borderWidth: 5,
                            label: {
                                show: false
                            }
                        }
                    },
                    data: data
                },
                geoCoord: cord
            },
            {
                name: '高人流量',
                type: 'map',
                mapType: 'none',
                data: [],
                markPoint: {
                    symbol: 'emptyCircle',
                    symbolSize: function (v) {
                        return 10 + v / 1000
                    },
                    effect: {
                        show: true,
                        shadowBlur: 1
                    },
                    itemStyle: {
                        normal: {
                            label: {show: true}
                        }
                    },
                    data: top
                }
            }
        ]
    });

    // 获取百度地图实例，使用百度地图自带的控件
    var bmap = myChart.getModel().getComponent('bmap').getBMap();
    bmap.disableScrollWheelZoom();//禁用滑轮放大缩小

    //一条线
    var polylinePointsArray = [];
    for (var j = 0; j < LineLL.length; j++) {
        polylinePointsArray.push(new BMap.Point(LineLL[j][0], LineLL[j][1]));
    }
    polylineOptions = {
        strokeColor: "blue",
        strokeWeight: 4,
        strokeOpacity: 0.9
    };
    var polyline = new BMap.Polyline(polylinePointsArray, polylineOptions);
    bmap.addOverlay(polyline);

//
//
//    function refreshData() {
//        if (option) {
//            data = [];
//            for (var bb = 0; bb < datas[time].length; bb++) {
//                data.push(datas[time][bb]);
//            }
//            option.series[0].markPoint.data = data;
//            var top = [];
//            for (var aa = 0; aa < data.length; aa++) {
//                if (data[aa].value > 90) {
//                    top.push(data[aa]);
//                }
//            }
//            option.series[1].markPoint.data = top;
//            console.log("刷新一次");
//            BMapExt.setOption(option, true);
//            time++;
//        }
//    }
//
//    refreshData();




</script>

</body>
</html>